### Outfit-Transformeræ¨¡å‹è§£è¯»

#### 1 CIR(Complementary item retrieval)

1. æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼š

   1. ä¼˜å…ˆå¤„ç†description
   2. æè¿°åœºæ™¯ï¼ŒæŠ½è±¡æ€»ç»“æˆé¢„è®¾å¥½çš„åœºæ™¯tag
   3. æ·»åŠ tagï¼Œå­£èŠ‚ï¼ˆä¼˜å…ˆæ¨èå½“å‰å­£èŠ‚çš„è¡£æœï¼‰
2. todoï¼š

   1. æ•°é‡æ˜¯å¦å›ºå®šï¼šè¾“å…¥ä¸€ä»¶è¡£æœï¼ˆä¸Šè£… or ä¸‹è£…ï¼‰
   2. æœé¥°ç±»å‹ç¡®å®šï¼šé™¤äº†åˆ†ä¸Šè£…ä¸‹è£…ï¼Œå­ç±»åˆ«æœ‰ä»€ä¹ˆï¼Ÿ
   3. çœ‹çœ‹è®­ç»ƒæ•°æ®é›†æ•°æ®ç»“æ„
   4. åŒä¸€ä»¶è¡£æœå¤šç§åœºæ™¯ï¼ˆä¼‘é—² or è¿åŠ¨ï¼‰
   5. æœ€å°‘éœ€è¦å¤šå°‘ä»¶èƒ½éªŒè¯è®­ç»ƒæœ‰æ•ˆæ€§ï¼ˆè®©æ¨¡å‹ç†è§£ï¼‰
   6. ä¸éœ€è¦ä»€ä¹ˆç”¨æˆ·ä¿¡æ¯ï¼Œä½†åœ¨å•å“æ¨èæ éœ€è¦ï¼šç”·è£…å¥³è£…orç”·å¥³åŒæ¬¾ï¼Œä¸Šè£…orä¸‹è£…å›¾ç‰‡ï¼Œåœºæ™¯ï¼ˆä¼‘é—² or è¿åŠ¨ï¼‰ï¼Œdescriptionï¼ˆæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿå¾…ç¡®è®¤ï¼‰
3. ä¼šè®®å¾…ç¡®è®¤

   1. agenté‚£è¾¹è¿›å±•å¦‚ä½•ï¼Œç°åœ¨ä¸åšå¤šè½®å¯¹è¯äº†
   2. hhræ‰“ç®—æ€ä¹ˆåˆ©ç”¨çŸ¥è¯†åº“
   3. agenté‚£è¾¹æ˜¯å¦æœ‰åšç”¨æˆ·åå¥½è®°å½•æ›´æ–°çš„åŠŸèƒ½

çº¯æ–‡å­—å…¨å“æ¨èï¼Œæ— æ³•å®ç°è§†è§‰æ•ˆæœï¼Ÿ

è¾“å…¥å›¾ç‰‡ã€è¾“å…¥åœºæ™¯tagã€è¾“å…¥ç±»å‹tagã€è¾“å…¥descriptionã€è¾“å‡ºæ¨èå•å“è®¾è®¡ã€å¹´é¾„

agent

##### 1.1 æŠ€æœ¯ç»†èŠ‚

1. å¯¹äºCIRï¼Œå®ƒå­¦ä¹ äº†å•ä¸ªåµŒå…¥å¼ç¼–ç éƒ¨åˆ†æœè£…çš„**å…¼å®¹æ€§çš„åµŒå…¥**ï¼Œä»¥åŠç”¨äºæ£€ç´¢å…¼å®¹é¡¹ç›®çš„**ç›®æ ‡é¡¹ç›®æè¿°**ï¼Œä½¿ç”¨KNNæœç´¢ä¸æ•´ä¸ªæœè£…åŒ¹é…ã€‚

   **ç”¨æˆ·è¾“å…¥**ï¼šç»™å®šåŒ…å«ä¸åŒå•†å“ï¼ˆä¾‹å¦‚åŒ…ã€é‹å­å’Œè£¤å­ï¼‰çš„éƒ¨åˆ†æœè£… + ç›®æ ‡å•†å“æè¿°ï¼ˆç±»åˆ«ï¼ˆâ€œä¸Šè¡£â€ï¼‰ or descriptionsï¼ˆå¸¦èŠ±çº¹è®¾è®¡çš„çº¯è‰²è¡¬è¡£ï¼‰ or tag ......ï¼‰
   **llmé‚£è¾¹å¯å¦å®ç°åŠŸèƒ½ï¼šå°†ç”¨æˆ·éœ€æ±‚è½¬æ¢æˆtagè¯­è¨€(descriptions)ç»™è¿™è¾¹æ¨¡å‹æ£€ç´¢ï¼Ÿï¼Ÿ
   æ•°æ®ç»“æ„ï¼šåŒ…å«é€‚åˆä»€ä¹ˆåœºåˆï¼Œä½†æ˜¯è¡£é•¿è¢–é•¿ç­‰å‚æ•°åœ¨å•å“æ¨èä¸­æˆ–è®¸æ²¡æœ‰ç”¨ã€‚**

   ![1751994876439](https://file+.vscode-resource.vscode-cdn.net/e%3A/fashion-ai-project/outfit-transformer-main/image/%E6%A8%A1%E5%9E%8B%E8%A7%A3%E8%AF%BB/1751994876439.png)

   ![1751997221759](image/æ¨¡å‹è§£è¯»/1751997221759.png)

   Target item tokenï¼š
   è¾“å…¥æ—¶ä»£è¡¨ï¼šç©ºimage + description

   ![1751998698343](image/æ¨¡å‹è§£è¯»/1751998698343.png)è¾“å‡ºæ—¶ä»£è¡¨ï¼šéƒ¨åˆ†æœè£…çš„å…¼å®¹æ€§ + ç›®æ ‡é¡¹ç›®description

   æ£€ç´¢ï¼šä½¿ç”¨set-wise outfit ranking lossè®­ç»ƒï¼Œä½¿ç”¨KNNè¿›è¡Œæ£€ç´¢
2. è®­ç»ƒ

   - å…ˆè¿›è¡ŒCP
     - ç„¶åä½¿ç”¨å­¦ä¹ çš„æƒé‡æ¥åˆå§‹åŒ–transformerå’Œæ–‡æœ¬å›¾åƒencoderï¼Œä»è€Œè¿›è¡ŒCIR

       We pre-train the framework on the compatibility prediction task and use the learned weights to initialize the transformer, image and text encoder for complementary item retrieval. This choice leads to a significant improvement for CIR (cf. Table 4(a)).
     - é€šè¿‡é€‰æ‹©æ›´æœ‰ç”¨çš„è´Ÿæ ·æœ¬è¿›è¡ŒCIRä»»åŠ¡çš„ä¼˜åŒ–

       We investigate different training strategies to improve retrieval performance. We employ a pre-training strategy where we first train the model on the compatibility prediction task as mentioned in Section 3.2.1. We also adopt curriculum learning to select more informative negative samples in different training stages. The details are presented in the Section 3.2.2.
   - å†»ä½text & image encoderå‚æ•°
3. å±€é™+è§£å†³æ–¹æ¡ˆï¼ˆå¤šä¸€ä¸ªè¯­è¨€agentï¼Œç”¨MCPæ¶æ„ä½¿ç”¨æ¨¡å‹å·¥å…·ï¼‰

   - å•å“æ¨èï¼šç”¨æˆ·å¿…é¡»è¾“å…¥targetçš„æè¿° or ç±»åˆ« or tag
     - uiè®¾è®¡ï¼šä¸€æ ç±»åˆ«é€‰æ‹©ï¼ˆé€‰æ‹©ä¸Šè¡£orä¸‹è¡£ï¼‰ï¼›ä¸€æ æ–‡æœ¬æ¡†ï¼šå¡«å†™ç›®æ ‡å•å“çš„ç‰¹å¾
     - å¯èƒ½çš„ä¼˜åŒ–ï¼šå¼•å…¥llmï¼Œllmå¯ä»¥å®ç°å¤šè½®å¯¹è¯ï¼Œä¹Ÿå¯ä»¥å®ç°å°†ç”¨æˆ·éœ€æ±‚è½¬æ¢æˆtagè¾“å…¥åˆ°æ¨¡å‹ä¸­è¿›è¡Œæ›´ä¼˜åŒ–çš„å•å“æ¨è
   - æ·»åŠ æ•´å¥—æœè£…æ¨èåŠŸèƒ½ï¼šå€ŸåŠ©llmï¼Œå°†ç”¨æˆ·éœ€æ±‚è½¬æ¢æˆtag or descriptionï¼Œå…ˆç”¨tagåœ¨æ•°æ®åº“é‡Œæ£€ç´¢å‡ºå¯¹åº”å•å“ï¼Œç„¶åéšæœºç»„åˆï¼Œé€‰æ‹©å…¼å®¹æ€§æœ€é«˜çš„
4. æ•°æ®é›†

   - CIRçš„æ£€ç´¢æ•°æ®é›†
     query
     label
     candidates

     ![1752001681558](image/æ¨¡å‹è§£è¯»/1752001681558.png)![1752001706543](image/æ¨¡å‹è§£è¯»/1752001706543.png)
   - é—®é¢˜ï¼š

     - æ— æ³•å¤„ç†ç”¨æˆ·ä¸ªäººåå¥½è¦æ±‚ï¼ˆå¦‚â€œåœºåˆâ€ç­‰ï¼‰
     - å¦‚æœåŠ ä¸Šåœºæ™¯ï¼Œæ•°æ®é›†ä¹Ÿéœ€è¦æ·»åŠ â€œé€‚åˆçš„åœºæ™¯â€çš„æ ‡ç­¾ï¼Ÿ
     - è¿˜æ˜¯è®©æ¨¡å‹è‡ªå·±å­¦ï¼Ÿï¼ˆéœ€è¦å¤§é‡æ•°æ®ï¼‰
   - è§£å†³æ–¹æ¡ˆï¼Ÿ

   1. ï¼ˆæœ€ç®€å•ï¼‰æ·»åŠ åœºæ™¯tagï¼ˆå›ºå®šå‡ ä¸ªåœºæ™¯ï¼Œéœ€è¦ä¿®æ”¹æ•°æ®é›†ç»“æ„ï¼‰ï¼Œæ ¹æ®tagç­›é€‰å‡ºå•å“ï¼Œé€šè¿‡KNNè¿›è¡Œç›¸ä¼¼åº¦æ£€ç´¢ï¼Œæ— æ¨èç†ç”±ï¼Œå¯è¯„åˆ†
   2. å¤–æ¥ä¸€ä¸ªLLMï¼Œæ¥å—ç”¨æˆ·éœ€æ±‚ï¼Œè½¬æ¢ä¸ºtagï¼Œæ ¹æ®tagç­›é€‰å‡ºå€™é€‰å•å“ï¼Œé€šè¿‡KNNè¿›è¡Œç›¸ä¼¼åº¦æ£€ç´¢ï¼Œé€‰æ‹©æœ€ç›¸ä¼¼Kä¸ªå•å“ä½œä¸ºæ¨èç»“æœï¼Œllmè´Ÿè´£ç”Ÿæˆæ¨èç†ç”±
   3. ......

   æ£€ç´¢ç»†èŠ‚ï¼šåœ¨ ``src/demo/2_build_index.py``å’Œ ``src/demo/3_run.py``ä¸­ï¼Œä½¿ç”¨äº†FAISSç­‰å‘é‡æ•°æ®åº“è¿›è¡Œé«˜æ•ˆKNNæ£€ç´¢:

```python
from .vectorstore import FAISSVectorStore

# åŠ è½½æ‰€æœ‰å•å“çš„åµŒå…¥
indexer = FAISSVectorStore(
    index_name='rec_index',
    d_embed=128,
    faiss_type='IndexFlatIP',
    base_dir=POLYVORE_PRECOMPUTED_REC_EMBEDDING_DIR.format(polyvore_dir=args.polyvore_dir),
)

# æ£€ç´¢æµç¨‹
query_embedding = model.embed_query([user_query])
# åªåœ¨ç›®æ ‡ç±»åˆ«ä¸‹çš„å•å“åµŒå…¥ä¸­åšKNN
results = indexer.search(query_embedding, top_k=8, category=target_category)
```

## ğŸ“ é¡¹ç›®æ•´ä½“æ¶æ„åˆ†æ

### 1. æ ¸å¿ƒç›®å½•ç»“æ„

```
outfit-transformer-main/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data/           # æ•°æ®å¤„ç†å±‚
â”‚   â”œâ”€â”€ models/         # æ¨¡å‹å®šä¹‰å±‚
â”‚   â”œâ”€â”€ run/           # è®­ç»ƒå’Œæµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ demo/          # æ¼”ç¤ºå’Œæ¨ç†è„šæœ¬
â”‚   â”œâ”€â”€ evaluation/    # è¯„ä¼°æŒ‡æ ‡
â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
```

## ï¿½ï¿½ å„æ¨¡å—åŠŸèƒ½è¯¦è§£

### 1. **data/ æ¨¡å—** - æ•°æ®å¤„ç†å±‚

Ran tool
**åŠŸèƒ½**ï¼š

- `datatypes.py`ï¼šå®šä¹‰æ•°æ®ç»“æ„ï¼ˆFashionItem, FashionCompatibilityQueryç­‰ï¼‰
- `datasets/polyvore.py`ï¼šPolyvoreæ•°æ®é›†åŠ è½½å™¨
- `collate_fn.py`ï¼šæ‰¹å¤„ç†æ•°æ®æ•´ç†å‡½æ•°

**æ ¸å¿ƒä½œç”¨**ï¼šå°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºæ¨¡å‹å¯å¤„ç†çš„æ ¼å¼

### 2. **models/ æ¨¡å—** - æ¨¡å‹å®šä¹‰å±‚

Ran tool
**æ ¸å¿ƒæ–‡ä»¶**ï¼š

- `outfit_transformer.py`ï¼šä¸»æ¨¡å‹æ¶æ„ï¼ˆå…¼å®¹æ€§é¢„æµ‹ + äº’è¡¥å•†å“æ£€ç´¢ï¼‰
- `outfit_clip_transformer.py`ï¼šåŸºäºCLIPçš„æ”¹è¿›ç‰ˆæœ¬
- `modules/`ï¼šç¼–ç å™¨ç»„ä»¶
  - `encoder.py`ï¼šå¤šæ¨¡æ€ç¼–ç å™¨ï¼ˆå›¾åƒ+æ–‡æœ¬ï¼‰
  - `image_encoder.py`ï¼šå›¾åƒç¼–ç å™¨ï¼ˆResNet18/CLIPï¼‰
  - `text_encoder.py`ï¼šæ–‡æœ¬ç¼–ç å™¨ï¼ˆBERT/CLIPï¼‰
- `load.py`ï¼šæ¨¡å‹åŠ è½½å™¨

### 3. **run/ æ¨¡å—** - è®­ç»ƒå’Œæµ‹è¯•è„šæœ¬

**è®­ç»ƒæµç¨‹**ï¼š

```
1_generate_clip_embeddings.py  # é¢„è®¡ç®—CLIPåµŒå…¥
2_train_compatibility.py       # å…¼å®¹æ€§é¢„æµ‹è®­ç»ƒ
2_test_compatibility.py        # å…¼å®¹æ€§é¢„æµ‹æµ‹è¯•
3_train_complementary.py       # äº’è¡¥å•†å“æ£€ç´¢è®­ç»ƒ
3_test_complementary.py        # äº’è¡¥å•†å“æ£€ç´¢æµ‹è¯•
```

### 4. **demo/ æ¨¡å—** - æ¼”ç¤ºå’Œæ¨ç†

**æ¨ç†æµç¨‹**ï¼š

```
1_generate_rec_embeddings.py   # ç”Ÿæˆæ¨èåµŒå…¥
2_build_index.py              # æ„å»ºå‘é‡ç´¢å¼•
3_run.py                      # è¿è¡Œæ¼”ç¤º
vectorstore.py                # å‘é‡å­˜å‚¨
vectorstore_utils.py          # å‘é‡å­˜å‚¨å·¥å…·
```

## å¿«é€Ÿç†è§£æ ¸å¿ƒåŠŸèƒ½çš„é˜…è¯»é¡ºåº

### ç¬¬ä¸€æ­¥ï¼šç†è§£æ•°æ®æµï¼ˆ5åˆ†é’Ÿï¼‰

**é˜…è¯»é¡ºåº**ï¼š

1. `src/data/datatypes.py` - äº†è§£æ•°æ®ç»“æ„
2. `src/data/datasets/polyvore.py` - äº†è§£æ•°æ®åŠ è½½
3. `src/data/collate_fn.py` - äº†è§£æ‰¹å¤„ç†

**å…³é”®ç†è§£ç‚¹**ï¼š

- è¾“å…¥ï¼šå•†å“å›¾åƒ + å•†å“æè¿°
- è¾“å‡ºï¼šå…¼å®¹æ€§åˆ†æ•° / æ¨èåµŒå…¥
- æ•°æ®æ ¼å¼ï¼šFashionItem, FashionCompatibilityQueryç­‰

### ç¬¬äºŒæ­¥ï¼šç†è§£æ¨¡å‹æ¶æ„ï¼ˆ10åˆ†é’Ÿï¼‰

**é˜…è¯»é¡ºåº**ï¼š

1. `src/models/outfit_transformer.py` - ä¸»æ¨¡å‹æ¶æ„
2. `src/models/modules/encoder.py` - å¤šæ¨¡æ€ç¼–ç å™¨
3. `src/models/load.py` - æ¨¡å‹åŠ è½½é€»è¾‘

**æ ¸å¿ƒæ¶æ„**ï¼š

```
è¾“å…¥: [å•†å“1, å•†å“2, ..., å•†å“N]
  â†“
å¤šæ¨¡æ€ç¼–ç å™¨: å›¾åƒç‰¹å¾ + æ–‡æœ¬ç‰¹å¾ â†’ ç»Ÿä¸€è¡¨ç¤º
  â†“
Transformerç¼–ç å™¨: å­¦ä¹ å•†å“é—´å…³ç³»
  â†“
è¾“å‡º: å…¼å®¹æ€§åˆ†æ•° / æ¨èåµŒå…¥
```

### ç¬¬ä¸‰æ­¥ï¼šç†è§£è®­ç»ƒæµç¨‹ï¼ˆ8åˆ†é’Ÿï¼‰

**é˜…è¯»é¡ºåº**ï¼š

1. `src/run/2_train_compatibility.py` - å…¼å®¹æ€§é¢„æµ‹è®­ç»ƒ
2. `src/run/3_train_complementary.py` - äº’è¡¥å•†å“æ£€ç´¢è®­ç»ƒ

**è®­ç»ƒç­–ç•¥**ï¼š

- **ä¸¤é˜¶æ®µè®­ç»ƒ**ï¼šå…ˆè®­ç»ƒå…¼å®¹æ€§é¢„æµ‹ï¼Œå†è®­ç»ƒäº’è¡¥å•†å“æ£€ç´¢
- **é¢„è®­ç»ƒæƒé‡**ï¼šä½¿ç”¨CLIP/BERTé¢„è®­ç»ƒæ¨¡å‹
- **å‚æ•°å†»ç»“**ï¼šå†»ç»“ç¼–ç å™¨å‚æ•°ï¼Œåªè®­ç»ƒTransformeréƒ¨åˆ†

### ç¬¬å››æ­¥ï¼šç†è§£æ¨ç†æµç¨‹ï¼ˆ5åˆ†é’Ÿï¼‰

**é˜…è¯»é¡ºåº**ï¼š

1. `src/demo/1_generate_rec_embeddings.py` - ç”ŸæˆåµŒå…¥
2. `src/demo/3_run.py` - æ¨ç†æ¼”ç¤º

# æ•°æ®é›†ä½¿ç”¨

## ğŸ“Š Polyvoreæ•°æ®é›†å¤„ç†è¯¦è§£

### ğŸ—‚ï¸ æ•°æ®é›†ç»“æ„

Polyvoreæ•°æ®é›†åŒ…å«ä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```
datasets/polyvore/
â”œâ”€â”€ item_metadata.json          # å•†å“å…ƒæ•°æ®
â”œâ”€â”€ images/                     # å•†å“å›¾ç‰‡
â”‚   â”œâ”€â”€ 0000001.jpg
â”‚   â”œâ”€â”€ 0000002.jpg
â”‚   â””â”€â”€ ...
â”œâ”€â”€ nondisjoint/               # éåˆ†ç¦»æ•°æ®é›†
â”‚   â”œâ”€â”€ train.json            # è®­ç»ƒé›†æ­é…
â”‚   â”œâ”€â”€ valid.json            # éªŒè¯é›†æ­é…
â”‚   â””â”€â”€ test.json             # æµ‹è¯•é›†æ­é…
â””â”€â”€ nondisjoint/              # ä»»åŠ¡ç‰¹å®šæ•°æ®
    â”œâ”€â”€ compatibility/        # å…¼å®¹æ€§ä»»åŠ¡
    â”‚   â”œâ”€â”€ train.json
    â”‚   â”œâ”€â”€ valid.json
    â”‚   â””â”€â”€ test.json
    â””â”€â”€ fill_in_the_blank/    # å¡«ç©ºä»»åŠ¡
        â”œâ”€â”€ train.json
        â”œâ”€â”€ valid.json
        â””â”€â”€ test.json
```

### ğŸ” ä½¿ç”¨çš„æ•°æ®

#### 1. **å•†å“å…ƒæ•°æ®** (`item_metadata.json`)

```python
# æ¯ä¸ªå•†å“åŒ…å«çš„å­—æ®µ
{
    "item_id": "0000001",           # å•†å“ID
    "semantic_category": "tops",     # å•†å“ç±»åˆ«
    "title": "Blue T-Shirt",        # å•†å“æ ‡é¢˜
    "url_name": "blue-tshirt",      # URLåç§°
    # å…¶ä»–å…ƒæ•°æ®å­—æ®µ...
}
```

**ä½¿ç”¨çš„å­—æ®µï¼š**

- âœ… `item_id`: å•†å“å”¯ä¸€æ ‡è¯†
- âœ… `semantic_category`: å•†å“ç±»åˆ«ï¼ˆtops, bottoms, shoesç­‰ï¼‰
- âœ… `title`: å•†å“æè¿°
- âœ… `url_name`: å¤‡ç”¨æè¿°

#### 2. **å•†å“å›¾ç‰‡** (`images/{item_id}.jpg`)

```python
# å›¾ç‰‡åŠ è½½å‡½æ•°
def _load_image(dataset_dir, item_id, size=(224, 224)):
    image_path = f"{dataset_dir}/images/{item_id}.jpg"
    return Image.open(image_path)
```

**ä½¿ç”¨æƒ…å†µï¼š**

- âœ… å½“ `load_image=True`æ—¶åŠ è½½
- âœ… ç”¨äºè§†è§‰ç‰¹å¾æå–
- âœ… åœ¨demoä¸­æ˜¾ç¤ºç»™ç”¨æˆ·

#### 3. **ä»»åŠ¡æ•°æ®** (å„ç§ `.json`æ–‡ä»¶)

**å…¼å®¹æ€§ä»»åŠ¡æ•°æ®ï¼š**

```json
{
    "label": 1,                    # æ˜¯å¦å…¼å®¹ï¼ˆ0/1ï¼‰
    "question": ["0000001", "0000002", "0000003"]  # æ­é…ä¸­çš„å•†å“ID
}
```

**å¡«ç©ºä»»åŠ¡æ•°æ®ï¼š**

```json
{
    "label": 2,                    # æ­£ç¡®ç­”æ¡ˆç´¢å¼•
    "question": ["0000001", "0000002"],  # å·²æœ‰æ­é…
    "answers": ["0000003", "0000004", "0000005", "0000006"]  # å€™é€‰å•†å“
}
```

**æ­é…é›†åˆæ•°æ®ï¼š**

```json
{
    "item_ids": ["0000001", "0000002", "0000003", "0000004"]  # å®Œæ•´æ­é…
}
```

### ğŸš« æœªä½¿ç”¨çš„æ•°æ®

æ ¹æ®ä»£ç åˆ†æï¼Œä»¥ä¸‹æ•°æ®**æ²¡æœ‰è¢«ä½¿ç”¨**ï¼š

1. **å•†å“å…ƒæ•°æ®ä¸­çš„å…¶ä»–å­—æ®µ**ï¼š

   - ä»·æ ¼ä¿¡æ¯
   - å“ç‰Œä¿¡æ¯
   - é¢œè‰²ä¿¡æ¯ï¼ˆé™¤äº†ç±»åˆ«ï¼‰
   - å°ºå¯¸ä¿¡æ¯
   - ç”¨æˆ·è¯„åˆ†
2. **å›¾ç‰‡é¢„å¤„ç†**ï¼š

   - å›¾ç‰‡å°ºå¯¸è°ƒæ•´ï¼ˆä»£ç ä¸­æœ‰sizeå‚æ•°ä½†æœªä½¿ç”¨ï¼‰
   - å›¾ç‰‡å¢å¼º
   - å›¾ç‰‡æ ‡å‡†åŒ–
3. **å¹¶è¡Œå›¾ç‰‡åŠ è½½**ï¼š

   - `load_images_parallel`å‡½æ•°å·²å®šä¹‰ä½†æœªä½¿ç”¨
   - `load_image_dict`å‡½æ•°è¢«æ³¨é‡Šæ‰

### ï¿½ï¿½ æ•°æ®å¤„ç†æµç¨‹

#### 1. **æ•°æ®åŠ è½½é˜¶æ®µ**

```python
# 1. åŠ è½½å…ƒæ•°æ®
metadata = load_metadata(dataset_dir)  # {item_id: metadata}

# 2. åŠ è½½é¢„è®¡ç®—åµŒå…¥ï¼ˆå¯é€‰ï¼‰
embedding_dict = load_embedding_dict(dataset_dir)  # {item_id: embedding}

# 3. åŠ è½½ä»»åŠ¡æ•°æ®
task_data = load_task_data(dataset_dir, dataset_type, task, split)
```

#### 2. **å•†å“å¯¹è±¡åˆ›å»º**

```python
def load_item(dataset_dir, metadata, item_id, load_image=False, embedding_dict=None):
    metadata_ = metadata[item_id]
    return FashionItem(
        item_id=metadata_['item_id'],
        category=metadata_['semantic_category'],
        image=_load_image(dataset_dir, item_id) if load_image else None,
        description=metadata_['title'] if metadata_['title'] else metadata_['url_name'],
        metadata=metadata_,
        embedding=embedding_dict[item_id] if embedding_dict else None
    )
```

#### 3. **æ•°æ®é›†ç±»**

**PolyvoreCompatibilityDataset** - å…¼å®¹æ€§é¢„æµ‹ï¼š

```python
# è¾“å…¥ï¼šæ­é…ä¸­çš„å•†å“åˆ—è¡¨
# è¾“å‡ºï¼šå…¼å®¹æ€§æ ‡ç­¾ï¼ˆ0/1ï¼‰
```

**PolyvoreFillInTheBlankDataset** - å¡«ç©ºä»»åŠ¡ï¼š

```python
# è¾“å…¥ï¼šéƒ¨åˆ†æ­é… + å€™é€‰å•†å“åˆ—è¡¨
# è¾“å‡ºï¼šæ­£ç¡®ç­”æ¡ˆç´¢å¼•
```

**PolyvoreTripletDataset** - ä¸‰å…ƒç»„å­¦ä¹ ï¼š

```python
# è¾“å…¥ï¼šæ­é…ä¸­çš„å•†å“
# è¾“å‡ºï¼šéšæœºé€‰æ‹©ä¸€ä¸ªå•†å“ä½œä¸ºç­”æ¡ˆï¼Œå…¶ä½™ä½œä¸ºæŸ¥è¯¢
```

**PolyvoreItemDataset** - å•†å“æ£€ç´¢ï¼š

```python
# è¾“å…¥ï¼šæ‰€æœ‰å•†å“
# è¾“å‡ºï¼šå•ä¸ªå•†å“å¯¹è±¡ï¼ˆç”¨äºdemoå±•ç¤ºï¼‰
```

### ğŸ¯ å…³é”®ç‰¹ç‚¹

1. **æ‡’åŠ è½½**ï¼šå›¾ç‰‡åªåœ¨éœ€è¦æ—¶åŠ è½½ï¼ˆ`load_image=True`ï¼‰
2. **é¢„è®¡ç®—åµŒå…¥**ï¼šæ”¯æŒä½¿ç”¨é¢„è®¡ç®—çš„CLIPåµŒå…¥åŠ é€Ÿ
3. **å¤šä»»åŠ¡æ”¯æŒ**ï¼šåŒä¸€æ•°æ®é›†æ”¯æŒå¤šç§ä»»åŠ¡
4. **å†…å­˜ä¼˜åŒ–**ï¼šé€šè¿‡å¯é€‰åŠ è½½å‡å°‘å†…å­˜å ç”¨
5. **åˆ†å¸ƒå¼æ”¯æŒ**ï¼šæ”¯æŒå¤šè¿›ç¨‹æ•°æ®åŠ è½½

### ï¿½ï¿½ ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨æ›´å¤šå…ƒæ•°æ®**ï¼šå¯ä»¥åˆ©ç”¨ä»·æ ¼ã€å“ç‰Œç­‰ä¿¡æ¯
2. **å›¾ç‰‡é¢„å¤„ç†**ï¼šæ·»åŠ æ ‡å‡†åŒ–å’Œå¢å¼º
3. **ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜å·²åŠ è½½çš„å›¾ç‰‡
4. **æ•°æ®éªŒè¯**ï¼šæ·»åŠ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

è¿™ä¸ªè®¾è®¡å¾ˆå¥½åœ°å¹³è¡¡äº†åŠŸèƒ½æ€§å’Œæ€§èƒ½ï¼Œé€šè¿‡å¯é€‰åŠ è½½å’Œé¢„è®¡ç®—åµŒå…¥æ¥é€‚åº”ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚

# å¾®è°ƒæ€è·¯æ„æ€æŒ‡å—

### 1. **æ•°æ®å±‚é¢å¾®è°ƒ**

**æ€è·¯1ï¼šå¤šè¯­è¨€æ”¯æŒ**

```python
# åœ¨text_encoder.pyä¸­æ·»åŠ å¤šè¯­è¨€æ”¯æŒ
class MultilingualTextEncoder(BaseTextEncoder):
    def __init__(self, languages=['zh', 'en']):
        # ä½¿ç”¨å¤šè¯­è¨€BERTæˆ–XLM-R
        self.models = {lang: AutoModel.from_pretrained(f'xlm-roberta-base') 
                      for lang in languages}
```

**æ€è·¯2ï¼šå¤šæ¨¡æ€å¢å¼º**

```python
# åœ¨image_encoder.pyä¸­æ·»åŠ æ›´å¤šè§†è§‰ç‰¹å¾
class EnhancedImageEncoder(nn.Module):
    def __init__(self):
        # æ·»åŠ é¢œè‰²ã€çº¹ç†ã€å½¢çŠ¶ç­‰ä¸“é—¨çš„ç‰¹å¾æå–å™¨
        self.color_encoder = ColorEncoder()
        self.texture_encoder = TextureEncoder()
        self.shape_encoder = ShapeEncoder()
```

### 2. **æ¨¡å‹æ¶æ„å¾®è°ƒ**

**æ€è·¯1ï¼šæ³¨æ„åŠ›æœºåˆ¶æ”¹è¿›**

```python
# åœ¨outfit_transformer.pyä¸­æ”¹è¿›Transformer
class EnhancedTransformer(nn.Module):
    def __init__(self):
        # æ·»åŠ å•†å“ç±»åˆ«æ„ŸçŸ¥çš„æ³¨æ„åŠ›
        self.category_attention = CategoryAwareAttention()
        # æ·»åŠ æ—¶é—´æ„ŸçŸ¥çš„æ³¨æ„åŠ›ï¼ˆå­£èŠ‚æ€§ï¼‰
        self.temporal_attention = TemporalAttention()
```

**æ€è·¯2ï¼šå¤šä»»åŠ¡å­¦ä¹ **

```python
# åŒæ—¶è®­ç»ƒå¤šä¸ªä»»åŠ¡
class MultiTaskOutfitTransformer(nn.Module):
    def forward(self, inputs):
        # å…¼å®¹æ€§é¢„æµ‹
        compatibility_score = self.compatibility_head(inputs)
        # é£æ ¼åˆ†ç±»
        style_pred = self.style_head(inputs)
        # åœºåˆæ¨è
        occasion_pred = self.occasion_head(inputs)
        return compatibility_score, style_pred, occasion_pred
```

### 3. **è®­ç»ƒç­–ç•¥å¾®è°ƒ**

**æ€è·¯1ï¼šè¯¾ç¨‹å­¦ä¹ **

```python
# åœ¨è®­ç»ƒè„šæœ¬ä¸­æ·»åŠ è¯¾ç¨‹å­¦ä¹ 
def curriculum_learning(epoch, dataset):
    if epoch < 50:
        # ç®€å•æ ·æœ¬ï¼šç›¸åŒç±»åˆ«çš„å•†å“
        return filter_simple_samples(dataset)
    elif epoch < 100:
        # ä¸­ç­‰æ ·æœ¬ï¼šç›¸ä¼¼é£æ ¼çš„å•†å“
        return filter_medium_samples(dataset)
    else:
        # å›°éš¾æ ·æœ¬ï¼šè·¨é£æ ¼çš„å•†å“
        return filter_hard_samples(dataset)
```

**æ€è·¯2ï¼šå¯¹æ¯”å­¦ä¹ **

```python
# æ·»åŠ å¯¹æ¯”å­¦ä¹ æŸå¤±
class ContrastiveLoss(nn.Module):
    def forward(self, anchor, positive, negative):
        # æ­£æ ·æœ¬ï¼šå…¼å®¹çš„å•†å“ç»„åˆ
        # è´Ÿæ ·æœ¬ï¼šä¸å…¼å®¹çš„å•†å“ç»„åˆ
        return contrastive_loss(anchor, positive, negative)
```

### 4. **æ¨ç†ä¼˜åŒ–å¾®è°ƒ**

**æ€è·¯1ï¼šå®æ—¶æ¨è**

```python
# åœ¨demoä¸­æ·»åŠ å®æ—¶æ¨è
class RealTimeRecommender:
    def __init__(self):
        self.vector_index = build_faiss_index()
        self.cache = LRUCache(maxsize=1000)
  
    def recommend(self, user_items, top_k=10):
        # å®æ—¶æ£€ç´¢ + ç¼“å­˜ä¼˜åŒ–
        return self.fast_search(user_items, top_k)
```

**æ€è·¯2ï¼šä¸ªæ€§åŒ–æ¨è**

```python
# æ·»åŠ ç”¨æˆ·åå¥½å»ºæ¨¡
class PersonalizedRecommender:
    def __init__(self):
        self.user_encoder = UserPreferenceEncoder()
        self.item_encoder = ItemEncoder()
  
    def recommend(self, user_profile, candidate_items):
        # ç»“åˆç”¨æˆ·åå¥½å’Œå•†å“ç‰¹å¾
        return self.personalized_ranking(user_profile, candidate_items)
```

## ğŸ“‹ å¾®è°ƒå®æ–½å»ºè®®

### 1. **æ¸è¿›å¼å¾®è°ƒ**

1. å…ˆåœ¨å°æ•°æ®é›†ä¸ŠéªŒè¯æƒ³æ³•
2. é€æ­¥å¢åŠ æ•°æ®é‡å’Œæ¨¡å‹å¤æ‚åº¦
3. ä½¿ç”¨A/Bæµ‹è¯•éªŒè¯æ•ˆæœ

### 2. **å…³é”®æŒ‡æ ‡ç›‘æ§**

- å…¼å®¹æ€§é¢„æµ‹å‡†ç¡®ç‡
- æ¨èç›¸å…³æ€§
- æ¨ç†é€Ÿåº¦
- ç”¨æˆ·æ»¡æ„åº¦

### 3. **æŠ€æœ¯æ ˆé€‰æ‹©**

- **æ•°æ®å¤„ç†**ï¼šä¿æŒç°æœ‰çš„Polyvoreæ•°æ®æ ¼å¼
- **æ¨¡å‹æ¡†æ¶**ï¼šç»§ç»­ä½¿ç”¨PyTorch
- **æ¨ç†åŠ é€Ÿ**ï¼šè€ƒè™‘ONNXã€TensorRT
- **éƒ¨ç½²æ–¹æ¡ˆ**ï¼šDocker + FastAPI

è¿™æ ·çš„é˜…è¯»å’Œç†è§£æ–¹å¼èƒ½å¸®åŠ©ä½ å¿«é€ŸæŒæ¡é¡¹ç›®æ ¸å¿ƒï¼Œå¹¶åŸºäºç°æœ‰æ¶æ„è®¾è®¡å‡ºæœ‰æ•ˆçš„å¾®è°ƒæ–¹æ¡ˆã€‚


è¿è¡Œæ–¹æ³•ï¼šæ‰“å¼€anaconda

![1752143946889](image/æ¨¡å‹è§£è¯»/1752143946889.png)
